import{p as w}from"./parse-c28c2630.js";import{j as g}from"./singletons-cb3d801d.js";import{i as E}from"./navigation-70c1025f.js";const A=g.apply_action;function L(e){const n=JSON.parse(e);return n.data&&(n.data=w(n.data)),n}function M(e,n=()=>{}){const i=async({action:r,result:a,reset:o})=>{a.type==="success"&&(o!==!1&&HTMLFormElement.prototype.reset.call(e),await E()),(location.origin+location.pathname===r.origin+r.pathname||a.type==="redirect"||a.type==="error")&&A(a)};async function l(r){var m,d,h,b,y;r.preventDefault();const a=new URL((m=r.submitter)!=null&&m.hasAttribute("formaction")?r.submitter.formAction:HTMLFormElement.prototype.cloneNode.call(e).action),o=new FormData(e),s=(d=r.submitter)==null?void 0:d.getAttribute("name");s&&o.append(s,(b=(h=r.submitter)==null?void 0:h.getAttribute("value"))!=null?b:"");const p=new AbortController;let u=!1;const f=(y=await n({action:a,cancel:()=>u=!0,controller:p,data:o,form:e}))!=null?y:i;if(u)return;let c;try{const t=await fetch(a,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:o,signal:p.signal});c=L(await t.text())}catch(t){if((t==null?void 0:t.name)==="AbortError")return;c={type:"error",error:t}}f({action:a,data:o,form:e,update:t=>i({action:a,result:c,reset:t==null?void 0:t.reset}),result:c,get type(){throw new Error("(result) => {...} has changed to ({ result }) => {...}")},get location(){throw new Error("(result) => {...} has changed to ({ result }) => {...}")},get error(){throw new Error("(result) => {...} has changed to ({ result }) => {...}")}})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",l),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",l)}}}export{M as e};
