import{p as g}from"./parse.d12b0d5b.mjs";import{h as n}from"./singletons.77e832fa.mjs";n.disable_scroll_handling;const L=n.goto;n.invalidate;const h=n.invalidateAll;n.preload_data;n.preload_code;n.before_navigate;n.after_navigate;const _=n.apply_action;function A(e){const r=JSON.parse(e);return r.data&&(r.data=g(r.data)),r}function F(e,r=()=>{}){const l=async({action:o,result:a,reset:i})=>{a.type==="success"&&(i!==!1&&HTMLFormElement.prototype.reset.call(e),await h()),(location.origin+location.pathname===o.origin+o.pathname||a.type==="redirect"||a.type==="error")&&_(a)};async function s(o){var u,b,f;o.preventDefault();const a=new URL((u=o.submitter)!=null&&u.hasAttribute("formaction")?o.submitter.formAction:HTMLFormElement.prototype.cloneNode.call(e).action),i=new FormData(e),p=(b=o.submitter)==null?void 0:b.getAttribute("name");p&&i.append(p,((f=o.submitter)==null?void 0:f.getAttribute("value"))??"");const d=new AbortController;let m=!1;const y=await r({action:a,cancel:()=>m=!0,controller:d,data:i,form:e})??l;if(m)return;let c;try{const t=await fetch(a,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:i,signal:d.signal});c=A(await t.text()),c.type==="error"&&(c.status=t.status)}catch(t){if((t==null?void 0:t.name)==="AbortError")return;c={type:"error",error:t}}y({action:a,data:i,form:e,update:t=>l({action:a,result:c,reset:t==null?void 0:t.reset}),result:c})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",s)}}}export{F as e,L as g};
